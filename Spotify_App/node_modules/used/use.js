path = require('path')
var projectDir = process.cwd()+'/';
var srcDir = projectDir + 'src/';
var namespaces = require('ks-npm')

module.exports = GLOBAL.use = function(module) {
	var req;

	if (module.charAt(0) == "/") {
		req = require(path.normalize(projectDir+module));
	}
	else if (module.charAt(0) == "@") {
		req = null
		try {
			req = require(path.normalize(module.replace("@",srcDir)));
		}
		catch (e){
			if (module.indexOf("/") >= 0) {
				rootName = module.substr(1,module.indexOf('/')-1);
				lib = projectDir+namespaces[rootName]+module.replace("@","")
				req = require(lib);
				req["_fromVendor"] = true;
				req["_fromVendorRootname"] = rootName;
				req["_fromVendorPath"] = namespaces[rootName]+module.replace("@","");
			}
			else {
				throw e;
			}
		}
	}
	else {
		req = require(path.normalize(module));
	}

	if (req["_fromVendor"] === undefined || req["_vendorBundle"] === null) {
		req["_fromVendor"] = false;
	}

	req["_fromUsed"] = module
	return req
}



